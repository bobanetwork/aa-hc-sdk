import { decodeAbiParameters, parseAbiParameters } from "viem";

describe("Utils: ABI Encoding/Decoding", () => {
  it("should decode token price correctly", () => {
    const encodedData =
      "0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012323931362e383533383835323736303531360000000000000000000000000000";
    
    const [decodedData] = decodeAbiParameters(
      parseAbiParameters("string"),
      encodedData as `0x${string}`
    );
    
    expect(decodedData).toEqual("2916.8538852760516");
  });

  it("should decode long text correctly", () => {
    const encodedData =
      "0x000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000fe486f772063616e2074686520556e69746564205374617465732062616c616e636520646f6d65737469632065636f6e6f6d69632073747261746567696573206c696b652073747564656e74206c6f616e2072656d697373696f6e207769746820676c6f62616c2066696e616e6369616c2073686966747320737563682061732074686520696e6372656173696e67206d6f76656d656e7420617761792066726f6d2074686520555320446f6c6c617220627920425249435320636f756e74726965732c207768696c6520656e737572696e67206c6f6e672d7465726d20706f6c69746963616c20616e642065636f6e6f6d69632073746162696c6974793f0000";
    
    const [decodedData] = decodeAbiParameters(
      parseAbiParameters("string"),
      encodedData as `0x${string}`
    );
    
    expect(decodedData).toContain("How can the United States balance");
  });

  it("should decode another token price correctly", () => {
    const encodedData =
      "0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012323932382e333436363734393333303232380000000000000000000000000000";
    
    const [decodedData] = decodeAbiParameters(
      parseAbiParameters("string"),
      encodedData as `0x${string}`
    );
    
    expect(decodedData).toEqual("2928.3466749330228");
  });
});
